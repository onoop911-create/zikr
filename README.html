<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¯ Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø°ÙƒØ§Ø±">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .app-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .app-icon {
            font-size: 2.5em;
        }

        h1 {
            color: #667eea;
            font-size: 2em;
            margin: 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .current-date-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        /* Voice Controls */
        .voice-controls {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .voice-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-mic {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-stop {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-refresh {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 12px;
            border-radius: 10px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }

        .status-indicator.listening {
            background: #4caf50;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        .status-text {
            font-size: 1em;
            color: #333;
            font-weight: 500;
        }

        .transcript {
            background: white;
            border-radius: 10px;
            padding: 12px;
            min-height: 50px;
            color: #666;
            font-style: italic;
            text-align: center;
            font-size: 0.95em;
        }

        /* Dhikr Grid */
        .dhikr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .dhikr-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            animation: slideIn 0.5s ease;
            transition: transform 0.3s ease;
        }

        .dhikr-card:hover {
            transform: translateY(-5px);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dhikr-text {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
            line-height: 1.6;
        }

        .dhikr-count {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dhikr-label {
            font-size: 0.9em;
            color: #999;
            margin-top: 5px;
        }

        .count-animation {
            animation: countPulse 0.3s ease;
        }

        @keyframes countPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 1.3em;
            opacity: 0.9;
        }

        /* Calendar Section */
        .calendar-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn-cal {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .day-header {
            font-weight: bold;
            padding: 8px;
            text-align: center;
            color: #667eea;
            font-size: 0.85em;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: #f5f5f5;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            font-size: 0.9em;
        }

        .calendar-day:hover {
            background: #e0e0e0;
        }

        .calendar-day.has-data {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid #ff9800;
        }

        .day-number {
            font-weight: bold;
        }

        .day-count {
            font-size: 0.75em;
            margin-top: 2px;
        }

        /* Statistics */
        .stats-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .period-btn.active {
            background: #667eea;
            color: white;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .simple-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chart-label {
            min-width: 150px;
            font-weight: 600;
            color: #333;
        }

        .chart-bar-fill {
            flex: 1;
            background: #f0f0f0;
            border-radius: 10px;
            height: 30px;
            position: relative;
            overflow: hidden;
        }

        .chart-bar-value {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
        }

        /* Manage Dhikr */
        .manage-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .add-dhikr-form {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-help {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .dhikr-list {
            list-style: none;
        }

        .dhikr-list-item {
            background: #f9f9f9;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dhikr-list-text {
            font-size: 1.2em;
            color: #333;
        }

        .btn-delete {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        /* Settings & Reminders */
        .settings-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .setting-item {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .setting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .setting-description {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .reminder-item {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid #667eea;
        }

        .reminder-info {
            flex: 1;
        }

        .reminder-time {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .reminder-text {
            color: #666;
        }

        .reminder-actions {
            display: flex;
            gap: 10px;
        }

        .time-input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 100px;
        }

        .nav-item:hover {
            background: #f5f5f5;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-icon {
            font-size: 1.8em;
        }

        .nav-label {
            font-size: 0.75em;
            font-weight: 600;
        }

        .browser-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
            text-align: center;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.5em;
            }

            .dhikr-grid {
                grid-template-columns: 1fr;
            }

            .voice-btn {
                width: 60px;
                height: 60px;
                font-size: 1.8em;
            }

            .calendar-grid {
                gap: 5px;
            }

            .nav-icon {
                font-size: 1.5em;
            }

            .nav-label {
                font-size: 0.7em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="app-title">
                <span class="app-icon">ğŸ•Œ</span>
                <h1>Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</h1>
            </div>
            
            <div id="browserWarning" class="browser-warning" style="display: none;">
                Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Chrome Ø£Ùˆ Edge.
            </div>
        </div>

        <!-- Home Tab (Counter + Calendar) -->
        <div id="home-tab" class="tab-content active">
            <div class="current-date-badge" id="currentDate"></div>

            <div class="voice-controls">
                <div class="control-buttons">
                    <button id="startBtn" class="voice-btn btn-mic" title="Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹">ğŸ¤</button>
                    <button id="stopBtn" class="voice-btn btn-stop" style="display: none;" title="Ø¥ÙŠÙ‚Ø§Ù">â¹ï¸</button>
                    <button id="resetBtn" class="voice-btn btn-refresh" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†">ğŸ”„</button>
                </div>

                <div class="status">
                    <div id="statusIndicator" class="status-indicator"></div>
                    <div id="statusText" class="status-text">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡</div>
                </div>

                <div id="transcript" class="transcript">
                    Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„Ø¨Ø¯Ø¡...
                </div>
            </div>

            <div id="dhikrGrid" class="dhikr-grid"></div>

            <div id="emptyState" class="empty-state">
                Ù‚Ù„ Ø£Ø°ÙƒØ§Ø±Ùƒ ÙˆØ³ÙŠØªÙ… Ø¹Ø¯Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ¨
            </div>

            <!-- Calendar Section -->
            <div class="calendar-section">
                <div class="calendar-header">
                    <div class="calendar-title" id="calendarTitle">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                    <div class="calendar-nav">
                        <button class="nav-btn-cal" id="prevMonth">â—€</button>
                        <button class="nav-btn-cal" id="nextMonth">â–¶</button>
                    </div>
                </div>
                
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-container">
                <h2 style="margin-bottom: 20px; color: #667eea; text-align: center;">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                
                <div class="period-selector">
                    <button class="period-btn active" data-period="week">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
                    <button class="period-btn" data-period="month">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</button>
                    <button class="period-btn" data-period="year">Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©</button>
                    <button class="period-btn" data-period="all">Ø§Ù„ÙƒÙ„</button>
                </div>

                <div class="stats-grid" id="statsGrid"></div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸ“ˆ Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ø°ÙƒØ§Ø±</h3>
                    <div class="simple-chart" id="topDhikrChart"></div>
                </div>
            </div>
        </div>

        <!-- Manage Dhikr Tab -->
        <div id="manage-tab" class="tab-content">
            <div class="manage-container">
                <h2 style="margin-bottom: 20px; color: #667eea; text-align: center;">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø±</h2>
                
                <div class="add-dhikr-form">
                    <h3 style="margin-bottom: 20px; color: #333;">Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ± Ø¬Ø¯ÙŠØ¯</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Ù†Øµ Ø§Ù„Ø°ÙƒØ±:</label>
                        <input type="text" id="newDhikrText" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø§ Ø­ÙˆÙ„ ÙˆÙ„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡">
                        <div class="form-help">Ø§ÙƒØªØ¨ Ø§Ù„Ø°ÙƒØ± ÙƒÙ…Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ÙŠØ¸Ù‡Ø±</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <input type="text" id="newDhikrPatterns" class="form-input" placeholder="Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©: Ù„Ø§Ø­ÙˆÙ„ ÙˆÙ„Ø§Ù‚ÙˆØ© Ø§Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡ØŒ Ù„Ø§ Ø­ÙˆÙ„ Ùˆ Ù„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡">
                        <div class="form-help">Ø£Ø¶Ù Ø·Ø±Ù‚ Ù…Ø®ØªÙ„ÙØ© Ù„Ù†Ø·Ù‚ Ø£Ùˆ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø°ÙƒØ±</div>
                    </div>

                    <button class="btn-add" id="addDhikrBtn">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø°ÙƒØ±</button>
                </div>

                <h3 style="margin-bottom: 15px; color: #333;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø±:</h3>
                <ul class="dhikr-list" id="dhikrManageList"></ul>
            </div>
        </div>

        <!-- Settings Tab (includes Reminders) -->
        <div id="settings-tab" class="tab-content">
            <div class="settings-container">
                <h2 style="margin-bottom: 20px; color: #667eea; text-align: center;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                
                <div class="setting-item">
                    <div class="setting-header">
                        <div class="setting-title">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø·ÙˆÙ‚</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="showTranscriptToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-description">
                        Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙŠ ØªÙ†Ø·Ù‚Ù‡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹.
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-header">
                        <div class="setting-title">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notificationsToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-description">
                        Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.
                    </div>
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 2px solid #f0f0f0;">

                <h3 style="margin-bottom: 20px; color: #667eea;">ğŸ”” Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</h3>

                <div class="add-dhikr-form">
                    <h4 style="margin-bottom: 15px; color: #333;">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯</h4>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ÙˆÙ‚Øª:</label>
                        <input type="time" id="reminderTime" class="form-input time-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                        <input type="text" id="reminderText" class="form-input" placeholder="Ù…Ø«Ø§Ù„: ÙˆÙ‚Øª Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­">
                    </div>

                    <button class="btn-add" id="addReminderBtn">â• Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</button>
                </div>

                <h4 style="margin: 20px 0 15px; color: #333;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª:</h4>
                <div id="remindersList"></div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" data-tab="home">
            <div class="nav-icon">ğŸ </div>
            <div class="nav-label">Ø§Ù„Ø¹Ø¯Ø§Ø¯</div>
        </div>
        <div class="nav-item" data-tab="stats">
            <div class="nav-icon">ğŸ“Š</div>
            <div class="nav-label">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
        </div>
        <div class="nav-item" data-tab="manage">
            <div class="nav-icon">ğŸ“</div>
            <div class="nav-label">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</div>
        </div>
        <div class="nav-item" data-tab="settings">
            <div class="nav-icon">âš™ï¸</div>
            <div class="nav-label">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        </div>
    </div>

    <script>
        // Default Dhikr phrases
        const defaultDhikrPhrases = [
            {
                text: "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡",
                patterns: ["Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡", "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡", "Ø§Ø³ØªØºÙØ±Ø§Ù„Ù„Ù‡", "Ø£Ø³ØªØºÙØ±Ø§Ù„Ù„Ù‡"],
                isDefault: true
            },
            {
                text: "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡",
                patterns: ["Ù„Ø§ Ø§Ù„Ù‡ Ø§Ù„Ø§ Ø§Ù„Ù„Ù‡", "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡", "Ù„Ø§Ø§Ù„Ù‡ Ø§Ù„Ø§ Ø§Ù„Ù„Ù‡", "Ù„Ø§ Ø§Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡", "Ù„Ø§Ø§Ù„Ù‡ Ø¥Ù„Ø§Ø§Ù„Ù„Ù‡"],
                isDefault: true
            },
            {
                text: "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡",
                patterns: ["Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡", "Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡", "Ø§Ù„Ø­Ù…Ø¯ Ø§Ù„Ù„Ù‡"],
                isDefault: true
            },
            {
                text: "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡",
                patterns: ["Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡", "Ø³Ø¨Ø­Ø§Ù†Ø§Ù„Ù„Ù‡"],
                isDefault: true
            },
            {
                text: "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…",
                patterns: ["Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…", "Ø³Ø¨Ø­Ø§Ù†Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…", "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡Ø§Ù„Ø¹Ø¸ÙŠÙ…"],
                isDefault: true
            },
            {
                text: "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡",
                patterns: ["Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡", "Ø³Ø¨Ø­Ø§Ù†Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡", "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ùˆ Ø¨Ø­Ù…Ø¯Ù‡"],
                isDefault: true
            },
            {
                text: "Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±",
                patterns: ["Ø§Ù„Ù„Ù‡ Ø§ÙƒØ¨Ø±", "Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±", "Ø§Ù„Ù„Ù‡Ø§ÙƒØ¨Ø±", "Ø§Ù„Ù„Ù‡ ÙˆØ§ÙƒØ¨Ø±", "Ø§Ù„Ù„Ù‡ ÙˆØ£ÙƒØ¨Ø±"],
                isDefault: true
            }
        ];

        // State management
        let dhikrPhrases = [];
        let dhikrCounts = {};
        let dailyHistory = {};
        let reminders = [];
        let recognition = null;
        let isListening = false;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let currentPeriod = 'week';
        let showTranscript = true;
        let notificationsEnabled = false;

        // Load from localStorage
        function loadData() {
            const savedPhrases = localStorage.getItem('dhikrPhrases');
            dhikrPhrases = savedPhrases ? JSON.parse(savedPhrases) : [...defaultDhikrPhrases];
            
            const savedHistory = localStorage.getItem('dailyHistory');
            dailyHistory = savedHistory ? JSON.parse(savedHistory) : {};
            
            const savedReminders = localStorage.getItem('reminders');
            reminders = savedReminders ? JSON.parse(savedReminders) : [];
            
            const savedShowTranscript = localStorage.getItem('showTranscript');
            showTranscript = savedShowTranscript !== null ? JSON.parse(savedShowTranscript) : true;
            
            const savedNotifications = localStorage.getItem('notificationsEnabled');
            notificationsEnabled = savedNotifications !== null ? JSON.parse(savedNotifications) : false;
            
            const today = getTodayKey();
            dhikrCounts = dailyHistory[today] || {};
        }

        function saveData() {
            localStorage.setItem('dhikrPhrases', JSON.stringify(dhikrPhrases));
            localStorage.setItem('dailyHistory', JSON.stringify(dailyHistory));
            localStorage.setItem('reminders', JSON.stringify(reminders));
        }

        function getTodayKey() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function formatDate(dateKey) {
            const [year, month, day] = dateKey.split('-');
            const date = new Date(year, month - 1, day);
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            return `${days[date.getDay()]} ${day} ${months[date.getMonth()]} ${year}`;
        }

        function updateCurrentDate() {
            const today = getTodayKey();
            document.getElementById('currentDate').textContent = formatDate(today);
        }

        function normalizeArabic(text) {
            return text
                .replace(/Ø£|Ø¥|Ø¢/g, 'Ø§')
                .replace(/Ù‰/g, 'ÙŠ')
                .replace(/Ø©/g, 'Ù‡')
                .replace(/\s+/g, ' ')
                .trim()
                .toLowerCase();
        }

        function countDhikrInText(text) {
            const normalizedText = normalizeArabic(text);
            const counts = {};

            dhikrPhrases.forEach(dhikr => {
                let totalCount = 0;
                
                dhikr.patterns.forEach(pattern => {
                    const normalizedPattern = normalizeArabic(pattern);
                    const regex = new RegExp(normalizedPattern, 'g');
                    const matches = normalizedText.match(regex);
                    if (matches) {
                        totalCount += matches.length;
                    }
                });

                if (totalCount > 0) {
                    counts[dhikr.text] = totalCount;
                }
            });

            return counts;
        }

        function updateDhikrCounts(newCounts) {
            Object.keys(newCounts).forEach(dhikr => {
                if (!dhikrCounts[dhikr]) {
                    dhikrCounts[dhikr] = 0;
                }
                dhikrCounts[dhikr] += newCounts[dhikr];
            });
            
            const today = getTodayKey();
            dailyHistory[today] = {...dhikrCounts};
            saveData();
            
            renderDhikrGrid();
            renderCalendar();
        }

        function renderDhikrGrid() {
            const dhikrGrid = document.getElementById('dhikrGrid');
            const emptyState = document.getElementById('emptyState');
            const hasDhikr = Object.keys(dhikrCounts).length > 0;
            
            if (hasDhikr) {
                emptyState.style.display = 'none';
                dhikrGrid.style.display = 'grid';
                
                dhikrGrid.innerHTML = Object.entries(dhikrCounts)
                    .sort((a, b) => b[1] - a[1])
                    .map(([dhikr, count]) => `
                        <div class="dhikr-card">
                            <div class="dhikr-text">${dhikr}</div>
                            <div class="dhikr-count" id="count-${dhikr}">${count}</div>
                            <div class="dhikr-label">Ù…Ø±Ø©</div>
                        </div>
                    `).join('');
            } else {
                emptyState.style.display = 'block';
                dhikrGrid.style.display = 'none';
            }
        }

        function animateCountUpdate(dhikr) {
            const countElement = document.getElementById(`count-${dhikr}`);
            if (countElement) {
                countElement.classList.add('count-animation');
                setTimeout(() => {
                    countElement.classList.remove('count-animation');
                }, 300);
            }
        }

        function resetToday() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ')) {
                dhikrCounts = {};
                
                const today = getTodayKey();
                delete dailyHistory[today];
                saveData();
                
                renderDhikrGrid();
                renderCalendar();
                document.getElementById('transcript').textContent = 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.';
            }
        }

        function renderCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            
            calendarTitle.textContent = `${months[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();
            
            let html = '';
            
            days.forEach(day => {
                html += `<div class="day-header">${day}</div>`;
            });
            
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayData = dailyHistory[dateKey];
                const totalCount = dayData ? Object.values(dayData).reduce((a, b) => a + b, 0) : 0;
                const isToday = today.getFullYear() === currentYear && today.getMonth() === currentMonth && today.getDate() === day;
                
                let classes = 'calendar-day';
                if (totalCount > 0) classes += ' has-data';
                if (isToday) classes += ' today';
                
                html += `
                    <div class="${classes}">
                        <div class="day-number">${day}</div>
                        ${totalCount > 0 ? `<div class="day-count">${totalCount}</div>` : ''}
                    </div>
                `;
            }
            
            calendarGrid.innerHTML = html;
        }

        function calculateStats(period) {
            const now = new Date();
            let startDate;
            
            switch(period) {
                case 'week':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    break;
                case 'all':
                    startDate = new Date(0);
                    break;
            }
            
            let totalDays = 0;
            let totalDhikr = 0;
            let dhikrTotals = {};
            
            Object.entries(dailyHistory).forEach(([dateKey, counts]) => {
                const date = new Date(dateKey);
                if (date >= startDate && date <= now) {
                    totalDays++;
                    Object.entries(counts).forEach(([dhikr, count]) => {
                        totalDhikr += count;
                        dhikrTotals[dhikr] = (dhikrTotals[dhikr] || 0) + count;
                    });
                }
            });
            
            return { totalDays, totalDhikr, dhikrTotals, average: totalDays > 0 ? Math.round(totalDhikr / totalDays) : 0 };
        }

        function renderStats() {
            const stats = calculateStats(currentPeriod);
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.totalDhikr}</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalDays}</div>
                    <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.average}</div>
                    <div class="stat-label">Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                </div>
            `;
            
            const topDhikrChart = document.getElementById('topDhikrChart');
            const maxCount = Math.max(...Object.values(stats.dhikrTotals), 1);
            
            topDhikrChart.innerHTML = Object.entries(stats.dhikrTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 7)
                .map(([dhikr, count]) => {
                    const percentage = (count / maxCount) * 100;
                    return `
                        <div class="chart-bar">
                            <div class="chart-label">${dhikr}</div>
                            <div class="chart-bar-fill">
                                <div class="chart-bar-value" style="width: ${percentage}%">${count}</div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function renderReminders() {
            const remindersList = document.getElementById('remindersList');
            
            if (reminders.length === 0) {
                remindersList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª</p>';
                return;
            }
            
            remindersList.innerHTML = reminders.map((reminder, index) => `
                <div class="reminder-item">
                    <div class="reminder-info">
                        <div class="reminder-time">${reminder.time}</div>
                        <div class="reminder-text">${reminder.text}</div>
                    </div>
                    <div class="reminder-actions">
                        <button class="btn-delete" onclick="deleteReminder(${index})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function addReminder() {
            const time = document.getElementById('reminderTime').value;
            const text = document.getElementById('reminderText').value;
            
            if (!time) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ø§Ù„ØªØ°ÙƒÙŠØ±');
                return;
            }
            
            if (!text) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒÙŠØ±');
                return;
            }
            
            reminders.push({ time, text });
            saveData();
            renderReminders();
            
            document.getElementById('reminderTime').value = '';
            document.getElementById('reminderText').value = '';
            
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function deleteReminder(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ°ÙƒÙŠØ±ØŸ')) {
                reminders.splice(index, 1);
                saveData();
                renderReminders();
            }
        }

        function renderManageList() {
            const list = document.getElementById('dhikrManageList');
            list.innerHTML = dhikrPhrases.map((dhikr, index) => `
                <li class="dhikr-list-item">
                    <span class="dhikr-list-text">${dhikr.text}</span>
                    ${!dhikr.isDefault ? `<button class="btn-delete" onclick="deleteDhikr(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>` : '<span style="color: #999; font-size: 0.9em;">Ø§ÙØªØ±Ø§Ø¶ÙŠ</span>'}
                </li>
            `).join('');
        }

        function addDhikr() {
            const text = document.getElementById('newDhikrText').value.trim();
            const patternsInput = document.getElementById('newDhikrPatterns').value.trim();
            
            if (!text) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø°ÙƒØ±');
                return;
            }
            
            if (dhikrPhrases.some(d => d.text === text)) {
                alert('âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø°ÙƒØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }
            
            const patterns = patternsInput ? patternsInput.split(',').map(p => p.trim()) : [];
            patterns.unshift(text);
            
            dhikrPhrases.push({
                text: text,
                patterns: patterns,
                isDefault: false
            });
            
            saveData();
            renderManageList();
            
            document.getElementById('newDhikrText').value = '';
            document.getElementById('newDhikrPatterns').value = '';
            
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø°ÙƒØ± Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function deleteDhikr(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø°ÙƒØ±ØŸ')) {
                dhikrPhrases.splice(index, 1);
                saveData();
                renderManageList();
            }
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const targetTab = item.dataset.tab;
                
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`${targetTab}-tab`).classList.add('active');
                
                if (targetTab === 'stats') {
                    renderStats();
                } else if (targetTab === 'manage') {
                    renderManageList();
                } else if (targetTab === 'settings') {
                    renderReminders();
                }
            });
        });

        document.querySelectorAll('.period-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPeriod = btn.dataset.period;
                renderStats();
            });
        });

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        document.getElementById('addReminderBtn').addEventListener('click', addReminder);
        document.getElementById('resetBtn').addEventListener('click', resetToday);
        document.getElementById('addDhikrBtn').addEventListener('click', addDhikr);

        document.getElementById('showTranscriptToggle').addEventListener('change', (e) => {
            showTranscript = e.target.checked;
            localStorage.setItem('showTranscript', JSON.stringify(showTranscript));
            
            if (!showTranscript && isListening) {
                document.getElementById('transcript').textContent = 'ğŸ”’ Ø§Ù„Ù†Øµ Ù…Ø®ÙÙŠ (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø°Ù„Ùƒ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)';
                document.getElementById('transcript').style.fontStyle = 'italic';
                document.getElementById('transcript').style.color = '#999';
            }
        });

        document.getElementById('notificationsToggle').addEventListener('change', (e) => {
            notificationsEnabled = e.target.checked;
            localStorage.setItem('notificationsEnabled', JSON.stringify(notificationsEnabled));
            
            if (notificationsEnabled && 'Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission !== 'granted') {
                        notificationsEnabled = false;
                        e.target.checked = false;
                        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­');
                    }
                });
            }
        });

        // Speech recognition
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                document.getElementById('browserWarning').style.display = 'block';
                document.getElementById('startBtn').disabled = true;
                return null;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'ar-SA';
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.maxAlternatives = 3;
            
            recognition.onstart = () => {
                isListening = true;
                document.getElementById('statusIndicator').classList.add('listening');
                document.getElementById('statusText').textContent = 'Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù†Ø´Ø·...';
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('stopBtn').style.display = 'block';
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                        
                        const counts = countDhikrInText(transcript);
                        if (Object.keys(counts).length > 0) {
                            updateDhikrCounts(counts);
                            Object.keys(counts).forEach(dhikr => {
                                setTimeout(() => animateCountUpdate(dhikr), 100);
                            });
                        }
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (showTranscript) {
                    const displayText = finalTranscript || interimTranscript;
                    if (displayText) {
                        document.getElementById('transcript').textContent = displayText;
                        document.getElementById('transcript').style.fontStyle = finalTranscript ? 'normal' : 'italic';
                        document.getElementById('transcript').style.color = finalTranscript ? '#333' : '#999';
                    }
                } else {
                    document.getElementById('transcript').textContent = 'ğŸ”’ Ø§Ù„Ù†Øµ Ù…Ø®ÙÙŠ';
                    document.getElementById('transcript').style.fontStyle = 'italic';
                    document.getElementById('transcript').style.color = '#999';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                
                if (event.error === 'no-speech') {
                    return;
                }
                
                if (event.error === 'network') {
                    document.getElementById('statusText').textContent = 'Ø®Ø·Ø£: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
                } else if (event.error === 'not-allowed') {
                    document.getElementById('statusText').textContent = 'Ø®Ø·Ø£: Ø§Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†';
                } else {
                    document.getElementById('statusText').textContent = `Ø®Ø·Ø£: ${event.error}`;
                }
            };

            recognition.onend = () => {
                if (isListening) {
                    try {
                        recognition.start();
                    } catch (e) {
                        console.error('Error restarting recognition:', e);
                        isListening = false;
                        document.getElementById('statusIndicator').classList.remove('listening');
                        document.getElementById('statusText').textContent = 'Ù…ØªÙˆÙ‚Ù';
                        document.getElementById('startBtn').style.display = 'block';
                        document.getElementById('stopBtn').style.display = 'none';
                    }
                } else {
                    document.getElementById('statusIndicator').classList.remove('listening');
                    document.getElementById('statusText').textContent = 'Ù…ØªÙˆÙ‚Ù';
                    document.getElementById('startBtn').style.display = 'block';
                    document.getElementById('stopBtn').style.display = 'none';
                }
            };

            return recognition;
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            if (recognition) {
                try {
                    recognition.start();
                    document.getElementById('transcript').textContent = 'Ø§Ø³ØªÙ…Ø¹ Ø§Ù„Ø¢Ù†... Ù‚Ù„ Ø£Ø°ÙƒØ§Ø±Ùƒ';
                } catch (e) {
                    console.error('Error starting recognition:', e);
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ. ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†.');
                }
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            isListening = false;
            if (recognition) {
                recognition.stop();
            }
        });

        // Initialize
        window.addEventListener('load', () => {
            loadData();
            updateCurrentDate();
            renderDhikrGrid();
            renderCalendar();
            initSpeechRecognition();
            
            document.getElementById('showTranscriptToggle').checked = showTranscript;
            document.getElementById('notificationsToggle').checked = notificationsEnabled;
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => console.log('Service Worker registered'))
                    .catch(error => console.log('Service Worker registration failed:', error));
            }
        });
    </script>
</body>
</html>
